---
- name: Patch the web server
  hosts: all
  gather_facts: yes
  become: yes
  vars_files:
    - ../group_vars/email-creds.yml 


      

  tasks:
  - name: run patching tasks 
    ansible.builtin.include_tasks: "./roles/patch_os/tasks/patch.yml"

  - name: Reboot if required after patching
    ansible.builtin.include_tasks: "./roles/patch_os/tasks/reboot.yml"
    when: reboot == "yes"

  - name: Confirm system is running after patch
    ansible.builtin.command: uptime
    register: uptime_result
    changed_when: false 
